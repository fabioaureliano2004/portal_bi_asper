<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Portal Business Intelligence</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.2/animate.min.css" />
  <link rel="icon" href="https://images.squarespace-cdn.com/content/v1/648c617f3a34866b896bcf53/7f79b0ed-48b6-415e-9429-6cca7406a25b/favicon.ico?format=100w" />
  <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
  <script src="https://unpkg.com/feather-icons"></script>
  <style>
    body { font-size: .875rem; background: #f5f5f5; }
    .login-wrapper { display: flex; height: 100vh; align-items: center; justify-content: center; }
    .form-signin { max-width: 420px; padding: 15px; }
    .sidebar { position: fixed; top: 0; bottom: 0; left: 0; z-index: 100; padding: 48px 0 0; background: #f8f9fa; box-shadow: inset -1px 0 0 rgba(0, 0, 0, .1); }
    .sidebar-sticky { position: sticky; top: 0; height: calc(100vh - 48px); overflow-y: auto; }
    .nav-link { font-weight: 500; color: #333; border-left: 3px solid transparent; padding-left: 12px; transition: background-color 0.2s, border-color 0.2s; }
    .nav-link:hover { background-color:#f0f9f9; color:#007b6e; }
    .nav-link .feather { margin-right: 4px; color: #999; }
    .nav-link.active { background-color:#e0f3f3; color:#007b6e; border-left-color:#007b6e; }
    .nav-link.active .feather { color:#007b6e; }
    .responsive-iframe-container { position: relative; width: 100%; padding-top: 56.25%; }
    .responsive-iframe-container iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: 0; }
    .sidebar-heading-sm { font-size: 0.72rem; text-transform: uppercase; font-weight: 600; color: #6c757d; padding-left: 1rem; margin-top: 1.5rem; margin-bottom: 0.5rem; }
    .navbar h5 {margin: 0 auto;text-align: center;}
    
    /* Novos estilos para favoritos */
    .favorite-icon {
      float: right;
      color: #ccc;
      cursor: pointer;
      transition: color 0.2s;
      user-select: none;
    }
    .favorite-icon:hover {
      color: #ffc107;
    }
    .favorited {
      color: #ffc107 !important;
    }
    .user-info {
      color: #fff;
      margin-right: 15px;
      font-size: 0.9rem;
    }
    /* Estilo para o nome do usuário na sidebar */
    .user-sidebar {
      padding: 10px 15px;
      border-bottom: 1px solid #dee2e6;
      margin-bottom: 10px;
      font-weight: 600;
      color: #007b6e;
    }
    /* Estilos para a barra de busca */
    .search-container {
      padding: 0 15px 10px 15px;
      border-bottom: 1px solid #dee2e6;
      margin-bottom: 10px;
      position: relative;
    }
    .search-input {
      width: 100%;
      padding: 6px 32px 6px 12px;
      font-size: 0.8rem;
      border: 1px solid #ced4da;
      border-radius: 4px;
      background-color: #fff;
    }
    .search-input:focus {
      outline: none;
      border-color: #007b6e;
      box-shadow: 0 0 0 2px rgba(0, 123, 110, 0.25);
    }
    .search-results {
      max-height: 300px;
      overflow-y: auto;
      border: 1px solid #dee2e6;
      border-radius: 4px;
      background-color: #fff;
      display: none;
      position: absolute;
      width: calc(100% - 30px);
      z-index: 101;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      left: 15px;
      top: 56px;
    }
    .search-result-item {
      padding: 8px 12px;
      cursor: pointer;
      border-bottom: 1px solid #f0f0f0;
      font-size: 0.8rem;
    }
    .search-result-item:hover {
      background-color: #f8f9fa;
    }
    .search-result-item:last-child {
      border-bottom: none;
    }
    .search-clear {
      position: absolute;
      right: 25px;
      top: 10px;
      background: none;
      border: none;
      color: #6c757d;
      cursor: pointer;
      font-size: 18px;
      display: none;
    }
  </style>
</head>

<body>
  <!--INICIO DO BLOCO TELA LOGIN -->
  <div id="login-screen" class="login-wrapper">
    <form class="form-signin text-center" id="log" onsubmit="event.preventDefault(); logar_email();">
      <img class="mb-4" src="https://images.squarespace-cdn.com/content/v1/648c617f3a34866b896bcf53/3b57831c-5980-4d59-bb9e-06421fa4a38c/logo.png?format=1500w" alt="Logo" width="300" height="72">
      <h6 class="h4 mb-3 font-weight-normal">Portal Business Intelligence</h6>
      <input type="email" class="form-control" id="username" placeholder="Seu email" required>
      <br>
      <button type="button" class="btn btn-primary px-4" onclick="logar_email()">Entrar</button>
    </form>
  </div>
  <!-- FIM DO BLOCO TELA LOGIN -->

  <!-- INICIO PORTAL -->
  <div id="portal-screen" style="display:none;">
    <nav class="navbar navbar-dark fixed-top bg-dark flex-md-nowrap p-0 shadow">
      <a class="navbar-brand col-sm-3 col-md-2 mr-0" href="#" style="font-size: 0.85rem;">
        Portal Business Intelligence
      </a>
      <h5 id="report-title" class="mb-0 text-white">Cadência de Vendas</h5>
      <!-- removed navbar user display - username will be shown on sidebar only -->
    </nav>
    
    <div class="container-fluid">
      <div class="row">
        <nav class="col-md-2 d-none d-md-block sidebar">
          <div class="sidebar-sticky">
            <div class="px-3">
              <img src="https://images.squarespace-cdn.com/content/v1/648c617f3a34866b896bcf53/3b57831c-5980-4d59-bb9e-06421fa4a38c/logo.png?format=1500w" alt="Logo" width="120">
            </div>

            <!-- Nome do usuário logado (apenas aqui, acima da busca) -->
            <div class="user-sidebar" id="user-sidebar"></div>

            <!-- BARRA DE BUSCA -->
            <div class="search-container">
              <div style="position: relative;">
                <input type="text" class="search-input" id="search-input" placeholder="Buscar relatórios...">
                <button class="search-clear" id="search-clear">×</button>
              </div>
              <div class="search-results" id="search-results"></div>
            </div>

            <!-- SEÇÃO DE FAVORITOS -->
            <h6 class="sidebar-heading-sm">FAVORITOS</h6>
            <ul class="nav flex-column" id="favorites-menu">
              <!-- Os favoritos serão carregados dinamicamente aqui -->
            </ul>

            <h6 class="sidebar-heading-sm">RELATÓRIOS 2025</h6>

            <!-- INICIO DO BLOCO COMERCIAL PRIVADO -->
            <ul class="nav flex-column">
              <li class="nav-item">
                <a class="nav-link" data-toggle="collapse" href="#comercialPrivadoMenu" role="button" aria-expanded="true" aria-controls="comercialPrivadoMenu">
                  <span data-feather="folder"></span> Comercial Privado
                </a>
                <div class="collapse show" id="comercialPrivadoMenu">
                  <ul class="nav flex-column ml-3">
                    <li class="nav-item">
                      <a class="nav-link" href="#" onclick="loadReport('Resumo C-Level','https://app.powerbi.com/reportEmbed?reportId=881176ec-4b86-4af2-a234-8a14eac9be80&autoAuth=true&ctid=33f70dd6-5ac0-4e74-a8c4-7736b9998de1',this)">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-diagram-3" viewBox="0 0 16 16">
                            <path fill-rule="evenodd" d="M6 3.5A1.5 1.5 0 0 1 7.5 2h1A1.5 1.5 0 0 1 10 3.5v1A1.5 1.5 0 0 1 8.5 6v1H14a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-1 0V8h-5v.5a.5.5 0 0 1-1 0V8h-5v.5a.5.5 0 0 1-1 0v-1A.5.5 0 0 1 2 7h5.5V6A1.5 1.5 0 0 1 6 4.5zM8.5 5a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5zM0 11.5A1.5 1.5 0 0 1 1.5 10h1A1.5 1.5 0 0 1 4 11.5v1A1.5 1.5 0 0 1 2.5 14h-1A1.5 1.5 0 0 1 0 12.5zm1.5-.5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5zm4.5.5A1.5 1.5 0 0 1 7.5 10h1a1.5 1.5 0 0 1 1.5 1.5v1A1.5 1.5 0 0 1 8.5 14h-1A1.5 1.5 0 0 1 6 12.5zm1.5-.5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5zm4.5.5a1.5 1.5 0 0 1 1.5-1.5h1a1.5 1.5 0 0 1 1.5 1.5v1a1.5 1.5 0 0 1-1.5 1.5h-1a1.5 1.5 0 0 1-1.5-1.5zm1.5-.5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0  0-.5-.5z"/>
                        </svg> Resumo C-Level
                        <span class="favorite-icon" data-title="Resumo C-Level" data-url="https://app.powerbi.com/reportEmbed?reportId=881176ec-4b86-4af2-a234-8a14eac9be80&autoAuth=true&ctid=33f70dd6-5ac0-4e74-a8c4-7736b9998de1" onclick="toggleFavorite(event,this)">★</span>
                      </a>
                    </li>

                    <li class="nav-item">
                      <a class="nav-link" href="#" onclick="loadReport('Resumo Executivo de Vendas','https://app.powerbi.com/reportEmbed?reportId=e3a1499f-39de-4ec8-8257-414bcb903d53&autoAuth=true&ctid=33f70dd6-5ac0-4e74-a8c4-7736b9998de1',this)">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-bar-chart" viewBox="0 0 16 16">
                          <path d="M4 11H2v3h2zm5-4H7v7h2zm5-5v12h-2V2zm-2-1a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1zM6 7a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v7a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1zm-5 4a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1z"/>
                        </svg> Resumo Executivo de Vendas
                        <span class="favorite-icon" data-title="Resumo Executivo de Vendas" data-url="https://app.powerbi.com/reportEmbed?reportId=e3a1499f-39de-4ec8-8257-414bcb903d53&autoAuth=true&ctid=33f70dd6-5ac0-4e74-a8c4-7736b9998de1" onclick="toggleFavorite(event,this)">★</span>
                      </a>
                    </li>

                    <li class="nav-item">
                      <a class="nav-link active" href="#" onclick="loadReport('Cadência de Vendas','https://app.powerbi.com/reportEmbed?reportId=4bf71bbb-b931-43fa-bd70-a6089c27cdef&autoAuth=true&ctid=33f70dd6-5ac0-4e74-a8c4-7736b9998de1',this)">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-graph-up-arrow" viewBox="0 0 16 16">
                          <path fill-rule="evenodd" d="M0 0h1v15h15v1H0zm10 3.5a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-1 0V4.9l-3.613 4.417a.5.5 0 0 1-.74.037L7.06 6.767l-3.656 5.027a.5.5 0 0 1-.808-.588l4-5.5a.5.5 0 0 1 .758-.06l2.609 2.61L13.445 4H10.5a.5.5 0 0 1-.5-.5"/>
                          </svg> Cadência de Vendas
                        <span class="favorite-icon" data-title="Cadência de Vendas" data-url="https://app.powerbi.com/reportEmbed?reportId=4bf71bbb-b931-43fa-bd70-a6089c27cdef&autoAuth=true&ctid=33f70dd6-5ac0-4e74-a8c4-7736b9998de1" onclick="toggleFavorite(event,this)">★</span>
                      </a>
                    </li>

                    <li class="nav-item">
                      <a class="nav-link" href="#" onclick="loadReport('Carteira','https://app.powerbi.com/reportEmbed?reportId=aea0e943-1165-45e6-8206-93807c695370&autoAuth=true&ctid=33f70dd6-5ac0-4e74-a8c4-7736b9998de1',this)">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-credit-card" viewBox="0 0 16 16">
                          <path d="M0 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2zm2-1a1 1 0 0 0-1 1v1h14V4a1 1 0 0 0-1-1zm13 4H1v5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1z"/>
                          <path d="M2 10a1 1 0 0 1 1-1h1a1 1 0 0 1 1 1v1a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1z"/>
                        </svg> Carteira
                        <span class="favorite-icon" data-title="Carteira" data-url="https://app.powerbi.com/reportEmbed?reportId=aea0e943-1165-45e6-8206-93807c695370&autoAuth=true&ctid=33f70dd6-5ac0-4e74-a8c4-7736b9998de1" onclick="toggleFavorite(event,this)">★</span>
                      </a>
                    </li>

                    <li class="nav-item">
                      <a class="nav-link" href="#" onclick="loadReport('Fabricantes','https://app.powerbi.com/reportEmbed?reportId=be0af509-98a3-4d24-8adb-ef08d00cb218&autoAuth=true&ctid=33f70dd6-5ac0-4e74-a8c4-7736b9998de1',this)">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-seam" viewBox="0 0 16 16">
                          <path d="M8.186 1.113a.5.5 0 0 0-.372 0L1.846 3.5l2.404.961L10.404 2zm3.564 1.426L5.596 5 8 5.961 14.154 3.5zm3.25 1.7-6.5 2.6v7.922l6.5-2.6V4.24zM7.5 14.762V6.838L1 4.239v7.923zM7.443.184a1.5 1.5 0 0 1 1.114 0l7.129 2.852A.5.5 0 0 1 16 3.5v8.662a1 1 0 0 1-.629.928l-7.185 2.874a.5.5 0 0 1-.372 0L.63 13.09a1 1 0 0 1-.63-.928V3.5a.5.5 0 0 1 .314-.464z"/>
                        </svg> Fabricantes
                        <span class="favorite-icon" data-title="Fabricantes" data-url="https://app.powerbi.com/reportEmbed?reportId=be0af509-98a3-4d24-8adb-ef08d00cb218&autoAuth=true&ctid=33f70dd6-5ac0-4e74-a8c4-7736b9998de1" onclick="toggleFavorite(event,this)">★</span>
                      </a>
                    </li>

                    <li class="nav-item">
                      <a class="nav-link" href="#" onclick="loadReport('Produtividade','https://app.powerbi.com/reportEmbed?reportId=d98d8368-0831-4eaa-a086-826445656934&autoAuth=true&ctid=33f70dd6-5ac0-4e74-a8c4-7736b9998de1',this)">
                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-activity" viewBox="0 0 16 16">
                          <path fill-rule="evenodd" d="M6 2a.5.5 0 0 1 .47.33L10 12.036l1.53-4.208A.5.5 0 0 1 12 7.5h3.5a.5.5 0 0 1 0 1h-3.15l-1.88 5.17a.5.5 0 0 1-.94 0L6 3.964 4.47 8.171A.5.5 0 0 1 4 8.5H.5a.5.5 0 0 1 0-1h3.15l1.88-5.17A.5.5 0 0 1 6 2"/>
                        </svg> Produtividade
                        <span class="favorite-icon" data-title="Produtividade" data-url="https://app.powerbi.com/reportEmbed?reportId=d98d8368-0831-4eaa-a086-826445656934&autoAuth=true&ctid=33f70dd6-5ac0-4e74-a8c4-7736b9998de1" onclick="toggleFavorite(event,this)">★</span>
                      </a>
                    </li>

                    <li class="nav-item">
                      <a class="nav-link" href="#" onclick="loadReport('Oportunidades Perdidas','https://app.powerbi.com/reportEmbed?reportId=554f0a08-c609-44ba-855f-9c6e388f79b2&autoAuth=true&ctid=33f70dd6-5ac0-4e74-a8c4-7736b9998de1',this)">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-graph-down-arrow" viewBox="0 0 16 16">
                        <path fill-rule="evenodd" d="M0 0h1v15h15v1H0zm10 11.5a.5.5 0 0 0 .5.5h4a.5.5 0 0 0 .5-.5v-4a.5.5 0 0 0-1 0v2.6l-3.613-4.417a.5.5 0 0 0-.74-.037L7.06 8.233 3.404 3.206a.5.5 0 0 0-.808.588l4 5.5a.5.5 0 0 0 .758.06l2.609-2.61L13.445 11H10.5a.5.5 0 0 0-.5.5"/>
                      </svg> Perdidas
                        <span class="favorite-icon" data-title="Perdidas" data-url="https://app.powerbi.com/reportEmbed?reportId=554f0a08-c609-44ba-855f-9c6e388f79b2&autoAuth=true&ctid=33f70dd6-5ac0-4e74-a8c4-7736b9998de1" onclick="toggleFavorite(event,this)">★</span>
                      </a>
                    </li>

                    <li class="nav-item">
                      <a class="nav-link" href="#" onclick="loadReport('Simulador','https://app.powerbi.com/reportEmbed?reportId=edb48354-5da6-495f-bc9d-c9a9cfad7f06&autoAuth=true&ctid=33f70dd6-5ac0-4e74-a8c4-7736b9998de1',this)">
                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-sliders" viewBox="0 0 16 16">
                          <path fill-rule="evenodd" d="M11.5 2a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3M9.05 3a2.5 2.5 0 0 1 4.9 0H16v1h-2.05a2.5 2.5 0 0 1-4.9 0H0V3zM4.5 7a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3M2.05 8a2.5 2.5 0 0 1 4.9 0H16v1H6.95a2.5 2.5 0 0 1-4.9 0H0V8zm9.45 4a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3m-2.45 1a2.5 2.5 0 0 1 4.9 0H16v1h-2.05a2.5 2.5 0 0 1-4.9 0H0v-1z"/>
                      </svg> Simulador
                        <span class="favorite-icon" data-title="Simulador" data-url="https://app.powerbi.com/reportEmbed?reportId=edb48354-5da6-495f-bc9d-c9a9cfad7f06&autoAuth=true&ctid=33f70dd6-5ac0-4e74-a8c4-7736b9998de1" onclick="toggleFavorite(event,this)">★</span>
                      </a>
                    </li>
                    <br>
                  </ul>
                </div>
              </li>
            </ul>
            <!-- FIM DO BLOCO COMERCIAL PRIVADO -->

            <!-- INICIO DO BLOCO SALES OPS -->
            <ul class="nav flex-column">
              <li class="nav-item">
                <a class="nav-link" data-toggle="collapse" href="#salesopsMenu" role="button" aria-expanded="true" aria-controls="salesopsMenu">
                  <span data-feather="folder"></span> Sales Ops
                </a>
                <div class="collapse" id="salesopsMenu">
                  <ul class="nav flex-column ml-3">
                    <li class="nav-item">
                      <a class="nav-link" href="#" onclick="loadReport('Faturamento','https://app.powerbi.com/reportEmbed?reportId=19f6f941-7d57-4f79-99aa-55d4dab6dcf9&autoAuth=true&ctid=33f70dd6-5ac0-4e74-a8c4-7736b9998de1',this)">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-cash-stack" viewBox="0 0 16 16">
                          <path d="M1 3a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1zm7 8a2 2 0 1 0 0-4 2 2 0 0 0 0 4"/>
                          <path d="M0 5a1 1 0 0 1 1-1h14a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1H1a1 1 0 0 1-1-1zm3 0a2 2 0 0 1-2 2v4a2 2 0 0 1 2 2h10a2 2 0 0 1 2-2V7a2 2 0 0 1-2-2z"/>
                        </svg> Faturamento
                        <span class="favorite-icon" data-title="Faturamento" data-url="https://app.powerbi.com/reportEmbed?reportId=19f6f941-7d57-4f79-99aa-55d4dab6dcf9&autoAuth=true&ctid=33f70dd6-5ac0-4e74-a8c4-7736b9998de1" onclick="toggleFavorite(event,this)">★</span>
                      </a>
                    </li>
                    <li class="nav-item">
                      <a class="nav-link" href="#" onclick="loadReport('All Hands','https://app.powerbi.com/reportEmbed?reportId=73f00a0c-bb60-4b88-aa5c-ef4e60189e92&autoAuth=true&ctid=33f70dd6-5ac0-4e74-a8c4-7736b9998de1',this)">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-justify" viewBox="0 0 16 16">
                          <path fill-rule="evenodd" d="M2 12.5a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5m0-3a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5m0-3a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5m0-3a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5"/>
                        </svg> All Hands
                        <span class="favorite-icon" data-title="All Hands" data-url="https://app.powerbi.com/reportEmbed?reportId=73f00a0c-bb60-4b88-aa5c-ef4e60189e92&autoAuth=true&ctid=33f70dd6-5ac0-4e74-a8c4-7736b9998de1" onclick="toggleFavorite(event,this)">★</span>
                      </a>
                    </li>
                    <br>
                  </ul>
                </div>
              </li>
            </ul>
            <!-- FIM DO BLOCO SALES OPS -->

     <!-- INICIO DO BLOCO PRE-VENDAS -->
            <ul class="nav flex-column">
              <li class="nav-item">
                <a class="nav-link" data-toggle="collapse" href="#prevendasMenu" role="button" aria-expanded="true" aria-controls="prevendasMenu">
                  <span data-feather="folder"></span> Pré-vendas
                </a>
                <div class="collapse" id="prevendasMenu">
                  <ul class="nav flex-column ml-3">
                    <li class="nav-item">
                      <a class="nav-link" href="#" onclick="loadReport('Metas Pré-vendas','https://app.powerbi.com/reportEmbed?reportId=c299b655-a069-4106-9972-3cf1dfacc64f&autoAuth=true&ctid=33f70dd6-5ac0-4e74-a8c4-7736b9998de1',this)">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-bullseye" viewBox="0 0 16 16">
                          <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/>
                          <path d="M8 13A5 5 0 1 1 8 3a5 5 0 0 1 0 10m0 1A6 6 0 1 0 8 2a6 6 0 0 0 0 12"/>
                          <path d="M8 11a3 3 0 1 1 0-6 3 3 0 0 1 0 6m0 1a4 4 0 1 0 0-8 4 4 0 0 0 0 8"/>
                          <path d="M9.5 8a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0"/>
                        </svg> Metas
                        <span class="favorite-icon" data-title="Metas Pré-vendas" data-url="https://app.powerbi.com/reportEmbed?reportId=c299b655-a069-4106-9972-3cf1dfacc64f&autoAuth=true&ctid=33f70dd6-5ac0-4e74-a8c4-7736b9998de1" onclick="toggleFavorite(event,this)">★</span>
                      </a>
                    </li>

                    <li class="nav-item">
                      <a class="nav-link" href="#" onclick="loadReport('Atividades','https://app.powerbi.com/reportEmbed?reportId=e5d989e3-e856-4224-b8a7-9ea672d1c404&autoAuth=true&ctid=33f70dd6-5ac0-4e74-a8c4-7736b9998de1',this)">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-calendar3" viewBox="0 0 20 20">
                          <path d="M14 0H2a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2M1 3.857C1 3.384 1.448 3 2 3h12c.552 0 1 .384 1 .857v10.286c0 .473-.448.857-1 .857H2c-.552 0-1-.384-1-.857z"/>
                          <path d="M6.5 7a1 1 0 1 0 0-2 1 1 0 0 0 0 2m3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2m3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2m-9 3a1 1 0 1 0 0-2 1 1 0 0 0 0 2m3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2m3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2m3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2m-9 3a1 1 0 1 0 0-2 1 1 0 0 0 0 2m3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2m3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2"/>
                        </svg> Atividades
                        <span class="favorite-icon" data-title="Atividades" data-url="https://app.powerbi.com/reportEmbed?reportId=e5d989e3-e856-4224-b8a7-9ea672d1c404&autoAuth=true&ctid=33f70dd6-5ac0-4e74-a8c4-7736b9998de1" onclick="toggleFavorite(event,this)">★</span>
                      </a>
                    </li>

                    <li class="nav-item">
                      <a class="nav-link" href="#" onclick="loadReport('Certificações','https://app.powerbi.com/reportEmbed?reportId=d447c30d-b4b2-478c-a399-63a7224133a0&autoAuth=true&ctid=33f70dd6-5ac0-4e74-a8c4-7736b9998de1',this)">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-journal-code" viewBox="0 0 16 16">
                          <path fill-rule="evenodd" d="M8.646 5.646a.5.5 0 0 1 .708 0l2 2a.5.5 0 0 1 0 .708l-2 2a.5.5 0 0 1-.708-.708L10.293 8 8.646 6.354a.5.5 0 0 1 0-.708m-1.292 0a.5.5 0 0 0-.708 0l-2 2a.5.5 0 0 0 0 .708l2 2a.5.5 0 0 0 .708-.708L5.707 8l1.647-1.646a.5.5 0 0 0 0-.708"/>
                          <path d="M3 0h10a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2v-1h1v1a1 1 0 0 0 1 1h10a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H3a1 1 0 0 0-1 1v1H1V2a2 2 0 0 1 2-2"/>
                          <path d="M1 5v-.5a.5.5 0 0 1 1 0V5h.5a.5.5 0 0 1 0 1h-2a.5.5 0 0 1 0-1zm0 3v-.5a.5.5 0 0 1 1 0V8h.5a.5.5 0 0 1 0 1h-2a.5.5 0 0 1 0-1zm0 3v-.5a.5.5 0 0 1 1 0v.5h.5a.5.5 0 0 1 0 1h-2a.5.5 0 0 1 0-1z"/>
                        </svg> Certificações
                        <span class="favorite-icon" data-title="Certificações" data-url="https://app.powerbi.com/reportEmbed?reportId=d447c30d-b4b2-478c-a399-63a7224133a0&autoAuth=true&ctid=33f70dd6-5ac0-4e74-a8c4-7736b9998de1" onclick="toggleFavorite(event,this)">★</span>
                      </a>
                    </li>
                    <br>
                  </ul>
                </div>
              </li>
            </ul>
            <!-- FIM DO BLOCO PRE-VENDAS -->

            <!-- INICIO DO BLOCO ANALISES PONTUAIS -->
            <ul class="nav flex-column">
              <li class="nav-item">
                <a class="nav-link" data-toggle="collapse" href="#DiretoriaMenu" role="button" aria-expanded="true" aria-controls="DiretoriaMenu">
                  <span data-feather="folder"></span> Análises Pontuais
                </a>
                <div class="collapse" id="DiretoriaMenu">
                  <ul class="nav flex-column ml-3">
                    <li class="nav-item">
                      <a class="nav-link" href="#" onclick="loadReport('Comercial BR','https://app.powerbi.com/reportEmbed?reportId=e68459f5-d9df-49fa-9b29-6e831499729c&autoAuth=true&ctid=33f70dd6-5ac0-4e74-a8c4-7736b9998de1',this)">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pie-chart" viewBox="0 0 16 16">
                            <path d="M7.5 1.018a7 7 0 0 0-4.79 11.566L7.5 7.793zm1 0V7.5h6.482A7 7 0 0 0 8.5 1.018M14.982 8.5H8.207l-4.79 4.79A7 7 0 0 0 14.982 8.5M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8"/>
                          </svg> Comercial BR
                        <span class="favorite-icon" data-title="Comercial BR" data-url="https://app.powerbi.com/reportEmbed?reportId=e68459f5-d9df-49fa-9b29-6e831499729c&autoAuth=true&ctid=33f70dd6-5ac0-4e74-a8c4-7736b9998de1" onclick="toggleFavorite(event,this)">★</span>
                      </a>
                    </li>

                  <li class="nav-item">
                      <a class="nav-link" href="#" onclick="loadReport('Comercial US','https://app.powerbi.com/reportEmbed?reportId=fb118903-c5ef-4073-8932-f924fe964ecb&autoAuth=true&ctid=33f70dd6-5ac0-4e74-a8c4-7736b9998de1',this)">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pie-chart" viewBox="0 0 16 16">
                            <path d="M7.5 1.018a7 7 0 0 0-4.79 11.566L7.5 7.793zm1 0V7.5h6.482A7 7 0 0 0 8.5 1.018M14.982 8.5H8.207l-4.79 4.79A7 7 0 0 0 14.982 8.5M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8"/>
                          </svg> Comercial US
                        <span class="favorite-icon" data-title="Comercial US" data-url="https://app.powerbi.com/reportEmbed?reportId=fb118903-c5ef-4073-8932-f924fe964ecb&autoAuth=true&ctid=33f70dd6-5ac0-4e74-a8c4-7736b9998de1" onclick="toggleFavorite(event,this)">★</span>
                      </a>
                    </li>

                    <br>
                  </ul>
                </div>
              </li>
            </ul>
            <!-- FIM DO BLOCO ANALISES PONTUAIS -->

            <!-- LOGOUT DA PAGINA -->
            <ul class="nav flex-column mt-2">
              <li class="nav-item">
                <a class="nav-link" href="#" onclick="logout()">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-right" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M10 12.5a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 .5.5v2a.5.5 0 0 0 1 0v-2A1.5 1.5 0 0 0 9.5 2h-8A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h8a1.5 1.5 0 0 0 1.5-1.5v-2a.5.5 0 0 0-1 0z"/>
                    <path fill-rule="evenodd" d="M15.854 8.354a.5.5 0 0 0 0-.708l-3-3a.5.5 0 0 0-.708.708L14.293 7.5H5.5a.5.5 0 0 0 0 1h8.793l-2.147 2.146a.5.5 0 0 0 .708.708z"/>
                    </svg> Sair
                </a>
              </li>     
            </ul>
            <!-- FIM LOGOUT DA PAGINA -->

          </div>
        </nav>

        <!-- RELATÓRIO INICIAL AO LOGAR -->
        <main role="main" class="col-md-9 ml-sm-auto col-lg-10 px-4">
          <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
          </div>
          <br><br>
          <div class="responsive-iframe-container">
            <iframe id="powerbi-frame" src="https://app.powerbi.com/reportEmbed?reportId=4bf71bbb-b931-43fa-bd70-a6089c27cdef&autoAuth=true&ctid=33f70dd6-5ac0-4e74-a8c4-7736b9998de1" frameborder="0" allowFullScreen="true"></iframe>
          </div>
        </main>
      </div>
    </div>
  </div>
  <!-- FIM PORTAL -->

  <!-- FUNÇÕES JS -->
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>

  <script>
    feather.replace();

    // Função para extrair o nome do email
    function extractNameFromEmail(email) {
      const atIndex = email.indexOf('@');
      if (atIndex === -1) return email;
      
      const namePart = email.substring(0, atIndex);
      // Remove números e caracteres especiais, mantendo apenas letras e pontos/underscores
      const cleanName = namePart.replace(/[^a-zA-ZÀ-ÿ._\s]/g, '');
      // suporta separadores por '.' ou '_' ou ' ' — transforma em espaços e capitaliza
      return cleanName.split(/[._\s]+/).map(word =>
        word.charAt(0).toUpperCase() + word.slice(1).toLowerCase()
      ).join(' ');
    }

    // Preenche campo de e-mail com último login (mas NÃO faz login automático)
    function populateEmailFromStorage() {
      const lastEmail = localStorage.getItem('userEmail');
      if (lastEmail) {
        document.getElementById('username').value = lastEmail;
      }
    }

    // Função de login
    function logar_email() {
      const email = document.getElementById('username').value.trim();
      
      if (!email) {
        swal("Atenção", "Por favor, digite seu email", "warning");
        return;
      }

      // Validação básica de email e domínio
      if (!email.includes('@') || !email.includes('.')) {
        swal("Email inválido", "Por favor, digite um email válido", "error");
        return;
      }

      // Se for necessário restringir ao domínio, mantenha a validação abaixo:
      if (!email.toLowerCase().endsWith('@asper.tec.br')) {
        swal("Email inválido", "Por favor, digite um email válido", "error");
        return;
      }

      // Extrai o nome do email
      const userName = extractNameFromEmail(email);
      
      // Salva no localStorage (mantemos o e-mail e também o nome e isLoggedIn)
      localStorage.setItem('userEmail', email);
      localStorage.setItem('userName', userName);
      localStorage.setItem('isLoggedIn', 'true');

      // Atualiza a interface
      document.getElementById('login-screen').style.display = 'none';
      document.getElementById('portal-screen').style.display = 'block';
      
      // Atualiza o nome do usuário na interface
      updateUserInterface(userName);
      
      // Carrega os favoritos do usuário e atualiza estrelas visuais
      loadUserFavorites();
      updateFavoriteStars();
      
      swal("Login realizado!", `Bem-vindo, ${userName}!`, "success");
    }

    // Função para atualizar a interface com o nome do usuário (apenas na sidebar)
    function updateUserInterface(userName) {
      // atualiza somente o user-sidebar (nome acima da busca)
      document.getElementById('user-sidebar').textContent = userName;
      // não vamos mostrar nome no topo (navbar) — conforme solicitado
    }

    // Função de logout
    function logout() {
      // Mantemos userEmail (para pré-preencher), removemos userName e isLoggedIn
      const lastEmail = localStorage.getItem('userEmail') || '';
      localStorage.removeItem('userName');
      localStorage.removeItem('isLoggedIn');
      // NOTA: mantemos userFavorites e userEmail no storage para persistência
      // Atualiza UI para voltar à tela de login
      document.getElementById('portal-screen').style.display = 'none';
      document.getElementById('login-screen').style.display = 'flex';
      document.getElementById('username').value = lastEmail;
    }

    // Função para carregar relatório
    function loadReport(title, url, element) {
      // Segurança: evita undefined
      if (!url) return;
      document.getElementById('powerbi-frame').src = url;
      document.getElementById('report-title').textContent = title;
      
      // Remove a classe active de todos os links (apenas dos que possuem loadReport)
      document.querySelectorAll('.nav-link').forEach(link => {
        const onclick = link.getAttribute('onclick') || '';
        if (onclick.includes('loadReport')) {
          link.classList.remove('active');
        }
      });

      // Adiciona a classe active ao link clicado
      if (element) {
        element.classList.add('active');
      }
    }

    // Sistema de Favoritos
    function toggleFavorite(event, element) {
      event.stopPropagation();
      
      const title = element.getAttribute('data-title');
      const url = element.getAttribute('data-url');
      const favorite = { title, url };
      
      let favorites = JSON.parse(localStorage.getItem('userFavorites') || '[]');
      const existingIndex = favorites.findIndex(fav => fav.url === url);
      
      if (existingIndex > -1) {
        // Remove dos favoritos
        favorites.splice(existingIndex, 1);
        element.classList.remove('favorited');
        swal("Removido!", `${title} foi removido dos favoritos`, "info");
      } else {
        // Adiciona aos favoritos
        favorites.push(favorite);
        element.classList.add('favorited');
        swal("Adicionado!", `${title} foi adicionado aos favoritos`, "success");
      }
      
      localStorage.setItem('userFavorites', JSON.stringify(favorites));
      loadUserFavorites();
    }

    // Função para carregar favoritos do usuário
    function loadUserFavorites() {
      const favorites = JSON.parse(localStorage.getItem('userFavorites') || '[]');
      const favoritesMenu = document.getElementById('favorites-menu');
      
      favoritesMenu.innerHTML = '';
      
      if (favorites.length === 0) {
        favoritesMenu.innerHTML = '<li class="nav-item"><span class="nav-link text-muted">Nenhum favorito</span></li>';
        return;
      }
      
      favorites.forEach(fav => {
        const li = document.createElement('li');
        li.className = 'nav-item';
        // Escapa valores simples para evitar problemas em onclick (assumindo títulos simples)
        li.innerHTML = `
          <a class="nav-link" href="#" onclick="loadReport('${fav.title.replace(/'/g,"\\'")}','${fav.url.replace(/'/g,"\\'")}',this)">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-star-fill" viewBox="0 0 16 16" style="color: #ffc107;">
              <path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"/>
            </svg>
            ${fav.title}
          </a>
        `;
        favoritesMenu.appendChild(li);
      });
      
      // Atualiza o estado das estrelas nos relatórios
      updateFavoriteStars();
    }

    // Função para atualizar o estado visual das estrelas
    function updateFavoriteStars() {
      const favorites = JSON.parse(localStorage.getItem('userFavorites') || '[]');
      const favoriteUrls = favorites.map(fav => fav.url);

      document.querySelectorAll('.favorite-icon').forEach(icon => {
        const url = icon.getAttribute('data-url');
        if (favoriteUrls.includes(url)) {
          icon.classList.add('favorited');
        } else {
          icon.classList.remove('favorited');
        }
      });
    }

    // Sistema de Busca
    document.getElementById('search-input').addEventListener('input', function(e) {
      const searchTerm = e.target.value.toLowerCase().trim();
      const searchResults = document.getElementById('search-results');
      const searchClear = document.getElementById('search-clear');
      
      // Mostra/oculta botão de limpar
      searchClear.style.display = searchTerm ? 'block' : 'none';
      
      if (searchTerm.length < 2) {
        searchResults.style.display = 'none';
        return;
      }
      
      const allLinks = document.querySelectorAll('.nav-link');
      const results = [];
      
      allLinks.forEach(link => {
        const onclick = link.getAttribute('onclick') || '';
        // só consideramos links que chamam loadReport(...)
        if (!onclick.includes('loadReport')) return;
        // extrai title e url do onclick: loadReport('Title','URL',this)
        const m = onclick.match(/loadReport\('([^']+)','([^']+)'/);
        if (!m) return;
        const title = (m[1] || '').toLowerCase();
        const url = m[2] || '';
        if (title.includes(searchTerm)) {
          results.push({
            title: link.textContent.trim(),
            url,
            element: link
          });
        }
      });

      displaySearchResults(results, searchResults);
    });

    // Função para exibir resultados da busca
    function displaySearchResults(results, container) {
      container.innerHTML = '';
      
      if (results.length === 0) {
        container.innerHTML = '<div class="search-result-item text-muted">Nenhum resultado encontrado</div>';
      } else {
        results.forEach(result => {
          const div = document.createElement('div');
          div.className = 'search-result-item';
          div.textContent = result.title;
          div.onclick = () => {
            loadReport(result.title, result.url, result.element);
            container.style.display = 'none';
            document.getElementById('search-input').value = '';
            document.getElementById('search-clear').style.display = 'none';
          };
          container.appendChild(div);
        });
      }
      
      container.style.display = 'block';
    }

    // Limpar busca
    document.getElementById('search-clear').addEventListener('click', function() {
      document.getElementById('search-input').value = '';
      document.getElementById('search-results').style.display = 'none';
      this.style.display = 'none';
    });

    // Fechar resultados ao clicar fora
    document.addEventListener('click', function(e) {
      if (!e.target.closest('.search-container')) {
        document.getElementById('search-results').style.display = 'none';
      }
    });

    // Verificar status e preencher email ao carregar a página
    document.addEventListener('DOMContentLoaded', function() {
      populateEmailFromStorage();
      // NÃO realizamos login automático mesmo que isLoggedIn esteja em true
      // Atualiza ícones Feather e estrelas dos favoritos
      feather.replace();
      updateFavoriteStars();
      loadUserFavorites();
    });
  </script>
</body>
</html>
